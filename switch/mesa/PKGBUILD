# Maintainer:  fincs <fincs.alt1@gmail.com>

pkgbasename=mesa
pkgname=switch-$pkgbasename
pkgver=18.2_beta
pkgrel=1
pkgdesc='The Mesa 3D Graphics Library'
arch=('any')
url='https://github.com/devkitPro'
license=(MIT)
options=(!strip libtool staticlibs)
source=("${url}/${pkgbasename}/releases/download/v${pkgver}/${pkgname}-${pkgver}.tar.xz")
sha256sums=('a7fd2d5834c1dd6320074ee25d91d1fc06828b848fd7a081a2f6ad1df65f911a')
makedepends=('switch-pkg-config' 'devkitpro-pkgbuild-helpers')
depends=('switch-libdrm_nouveau')

build() {
  cd $pkgname

  source /opt/devkitpro/switchvars.sh

  autoreconf --force --verbose --install

  ./configure --prefix="${PORTLIBS_PREFIX}" --host=aarch64-none-elf \
    --disable-shared --enable-static --disable-dri --disable-glx \
    --enable-egl --disable-gbm --with-dri-drivers=no \
    --with-platforms=switch --with-gallium-drivers=nouveau \
    --enable-glx-tls

  make -j3
}

package() {
  cd $pkgname

  source /opt/devkitpro/switchvars.sh

  make -j3 DESTDIR="$pkgdir" install
}
